# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  pull_request:
    branches: [ master ]
  push:
    branches: [ master ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # Label of the container job
  container-job:
    # Containers must run in Linux based operating systems
    runs-on: ubuntu-latest
    # Docker Hub image that `container-job` executes in
    container: node:10.18-jessie
    services:
      mymssqlserver:
        image: docker.io/crzysan/mssql-docker:latest
        ports:
        - 1443:1433/tcp
        env:
          ACCEPT_EULA: Y
          SA_PASSWORD: Passw0rd
          MSSQL_DB: mydb
          MSSQL_USER: myuser
          MSSQL_PASSWORD: Mypass1
      myapp:
        image: docker.io/crzysan/myapp:v64
        ports:
        - 1443:1433/tcp
        env:
          IMAGE_APP: docker.io/crzysan/myapp:latest
          DOCKER_USER: ${{ secrets.DOCKER_USERNAME }}
          DOCKER_PASS: ${{ secrets.DOCKER_PASSWORD }}
          DATABASE_NAME: mydb
          DATABASE_HOST: localhost
          DATABASE_PASS: Passw0rd
          DATABASE_USER: SA
          DATABASE_PORT: 1433
          SECRET_KEY: h^z13$qr_s_wd65@gnj7a=xs7t05$w7q8!x_8zsld#
    steps:
    - uses: actions/checkout@v2
    - name: Run Tests
      run: |
        docker logs myapp
        curl -I localhost:8000/ht

