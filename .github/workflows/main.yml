# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ master ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # Label of the container job
  container-job:
    # Containers must run in Linux based operating systems
    runs-on: ubuntu-latest
    # Docker Hub image that `container-job` executes in
    container: node:10.18-jessie
    services:
      mymssqlserver:
        image: docker.io/crzysan/mssqldocker:latest
        ports:
        - 1443:1433/tcp
        env:
          ACCEPT_EULA: Y
          SA_PASSWORD: Passw0rd
          MSSQL_DB: mydb
          MSSQL_USER: myuser
          MSSQL_PASSWORD: Mypass1
    steps:
    - uses: actions/checkout@v2
    - name: Install dependencies
      run: |
        apt update
        apt install -y build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libsqlite3-dev libreadline-dev libffi-dev wget libbz2-dev
        wget https://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz
        tar -xf Python-3.7.4.tgz
        cd Python-3.7.4
        ./configure --enable-optimizations
        make -j 8
        make altinstall
        python3.7 --version

    - name: Run Tests
      run: |
        python manage.py makemigrations
        python manage.py makemigrations feedapp
        python manage.py migrate
        python manage.py test feedapp/


